# ğŸ§ª Guide d'exÃ©cution des tests - MCP Task Management Server

Ce guide explique comment exÃ©cuter les tests pour le serveur MCP de gestion des tÃ¢ches basÃ© sur l'architecture Domain-Driven Design (DDD).

## ğŸ“Š Vue d'ensemble des tests

### Test complete project

How to run full test
â””â”€â”€ pwd for see where i am
â”‚   â”œâ”€â”€ if i am not on cursor_agent directory: `cd /home/<username>/agentic-project/cursor_agent`
â”‚   â””â”€â”€ if i am on cursor_agent: `uv run pytest tests/dev/ -v --tb=short --full-trace`
â””â”€â”€ clear all not important files generated by test when test finish

### Structure des tests

```
cursor_agent/tests/
â”œâ”€â”€ quick/                    # âœ… Tests rapides (24 tests, < 1 min)
â”‚   â”œâ”€â”€ test_basic_api.py     # API de base et structures
â”‚   â”œâ”€â”€ test_imports.py       # Imports et dÃ©pendances
â”‚   â””â”€â”€ test_server_start.py  # DÃ©marrage serveur
â”œâ”€â”€ dev/
â”‚   â”œâ”€â”€ unit/                 # âœ… Tests unitaires (158 tests)
â”‚   â”‚   â”œâ”€â”€ test_auto_rule_generation.py    # 16 tests - GÃ©nÃ©ration auto-rÃ¨gles
â”‚   â”‚   â”œâ”€â”€ test_cursor_rules_tools.py      # 12 tests - Outils Cursor
â”‚   â”‚   â”œâ”€â”€ test_yaml_role_system.py        # 21 tests - SystÃ¨me YAML
â”‚   â”‚   â”œâ”€â”€ test_domain_entities.py         # 22 tests - EntitÃ©s domaine
â”‚   â”‚   â”œâ”€â”€ test_value_objects.py           # 26 tests - Objets valeur
â”‚   â”‚   â”œâ”€â”€ test_business_rules.py          # 15 tests - RÃ¨gles mÃ©tier
â”‚   â”‚   â”œâ”€â”€ test_ddd_boundaries.py          # 15 tests - Limites DDD
â”‚   â”‚   â”œâ”€â”€ test_mcp_tools.py               # 9 tests - Outils MCP
â”‚   â”‚   â””â”€â”€ test_mcp_tools_simple.py        # 6 tests - Outils MCP simples
â”‚   â””â”€â”€ integration/          # âœ… Tests d'intÃ©gration (14 tests)
â”‚       â”œâ”€â”€ test_auto_rule_integration.py   # 7 tests - IntÃ©gration auto-rÃ¨gles
â”‚       â”œâ”€â”€ test_mcp_integration.py         # 5 tests - IntÃ©gration MCP
â”‚       â””â”€â”€ test_role_integration.py        # 4 tests - IntÃ©gration rÃ´les
â””â”€â”€ conftest.py              # Configuration pytest
```

## ğŸš€ Commandes d'exÃ©cution avec `uv`

`uv` est utilisÃ© pour exÃ©cuter les tests. Il dÃ©tecte et utilise automatiquement l'environnement virtuel du projet (`.venv`), donc l'activation manuelle avec `source .venv/bin/activate` n'est plus nÃ©cessaire.

Assurez-vous d'Ãªtre dans le bon rÃ©pertoire :
```bash
pwd
cd /home/<username>/agentic-project/cursor_agent
```

### 1. **ExÃ©cuter tous les tests**
```bash
# Commande complÃ¨te (recommandÃ©e)
cd /home/<username>/agentic-project/cursor_agent && uv run pytest tests/ -v

# Ou si dÃ©jÃ  dans le rÃ©pertoire
uv run pytest tests/ -v
```

### 2. **Tests par catÃ©gorie**

#### Tests rapides (dÃ©veloppement) - 24 tests
```bash
# Tests rapides pour vÃ©rification (< 1 minute)
uv run pytest tests/quick/ -v
```

#### Tests unitaires - 130+ tests
```bash
# Tests unitaires seulement
uv run pytest tests/dev/unit/ -v
```

#### Tests d'intÃ©gration - 16 tests
```bash
# Tests d'intÃ©gration seulement  
uv run pytest tests/dev/integration/ -v
```

### 3. **Tests par markers**
```bash
# Tests MCP
uv run pytest -m mcp -v

# Tests DDD
uv run pytest -m ddd -v

# Tests YAML
uv run pytest -m yaml -v

# Tests de gÃ©nÃ©ration automatique de rÃ¨gles
uv run pytest -m auto_rule -v

# Tests des rÃ¨gles mÃ©tier
uv run pytest -m business_rules -v

# Tests d'architecture
uv run pytest -m architecture -v
```

### 4. **Tests avec couverture de code**
```bash
# Avec rapport de couverture HTML
uv run pytest tests/ --cov=src --cov-report=html

# Couverture simplifiÃ©e en terminal
uv run pytest tests/ --cov=src --cov-report=term-missing

# Couverture avec seuil minimum
uv run pytest tests/ --cov=src --cov-fail-under=80
```

### 5. **Tests spÃ©cifiques**
```bash
# Un seul fichier de test
uv run pytest tests/dev/unit/test_cursor_rules_tools.py -v

# Une seule classe de test
uv run pytest tests/dev/unit/test_cursor_rules_tools.py::TestCursorRulesTools -v

# Un seul test
uv run pytest tests/dev/unit/test_cursor_rules_tools.py::TestCursorRulesTools::test_update_auto_rule_success -v
```

### 6. **Tests en mode debug**
```bash
# Mode verbose avec logs
uv run pytest tests/ -v -s --log-cli-level=DEBUG

# ArrÃªter au premier Ã©chec
uv run pytest tests/ -x

# Mode silencieux (moins de sortie)
uv run pytest tests/ -q

# Afficher les 10 tests les plus lents
uv run pytest tests/ --durations=10
```

## ğŸ“‹ Configuration pytest

Le fichier `pytest.ini` contient la configuration suivante :

### Markers personnalisÃ©s
- `quick`: Tests rapides pour dÃ©veloppement (< 60 secondes)
- `unit`: Tests unitaires (1-2 minutes)
- `integration`: Tests d'intÃ©gration (2-3 minutes)
- `slow`: Tests lents (Ã  Ã©viter en dÃ©veloppement)
- `mcp`: Tests spÃ©cifiques au serveur MCP
- `ddd`: Tests de conception pilotÃ©e par le domaine
- `yaml`: Tests de configuration YAML
- `auto_rule`: Tests de gÃ©nÃ©ration automatique de rÃ¨gles
- `domain`: Tests de la couche domaine
- `business_rules`: Tests des rÃ¨gles mÃ©tier
- `architecture`: Tests de validation d'architecture

### Options par dÃ©faut
- Couverture de code activÃ©e (`--cov=src`)
- Rapport de couverture avec lignes manquantes
- Seuil de couverture minimum : 80%
- Logs CLI activÃ©s avec niveau INFO

## ğŸ¯ Recommandations d'usage

### **DÃ©veloppement quotidien**
```bash
# Tests rapides pour vÃ©rification
uv run pytest tests/quick/ -v
```

### **Avant commit**
```bash
# Tests complets
uv run pytest tests/ -v
```

### **DÃ©veloppement de nouvelles fonctionnalitÃ©s**
```bash
# Tests spÃ©cifiques Ã  votre zone de travail
uv run pytest tests/dev/unit/test_cursor_rules_tools.py -v
```

### **CI/CD**
```bash
# Tests avec couverture et rapport XML
uv run pytest tests/ --cov=src --cov-report=xml --cov-fail-under=80
```

### **Debug d'un test spÃ©cifique**
```bash
# Mode debug avec breakpoints
uv run pytest tests/dev/unit/test_cursor_rules_tools.py::TestCursorRulesTools::test_update_auto_rule_success -v -s --pdb
```

## ğŸ”§ RÃ©solution des problÃ¨mes

### Avertissements
Les 78 avertissements concernent des markers personnalisÃ©s non enregistrÃ©s. Ils sont normaux et n'affectent pas l'exÃ©cution des tests.

### DÃ©pendances manquantes
Si vous rencontrez des erreurs d'import, installez les dÃ©pendances de test :
```bash
uv pip install -e ".[test]"
```

## ğŸ“Š Couverture de test

### Couches testÃ©es
- **Domain Layer** : EntitÃ©s, objets valeur, Ã©vÃ©nements domaine (63 tests)
- **Application Layer** : Services application, DTOs, cas d'usage (25 tests)
- **Infrastructure Layer** : Repositories, services externes (30 tests)
- **Interface Layer** : Outils MCP, serveur (64 tests)

### FonctionnalitÃ©s testÃ©es
- **âœ… Gestion des tÃ¢ches** : CRUD complet, validation, transitions d'Ã©tat
- **âœ… SystÃ¨me de rÃ´les YAML** : Chargement, validation, intÃ©gration
- **âœ… GÃ©nÃ©ration auto-rÃ¨gles** : DÃ©clenchement, contenu, fallback
- **âœ… Outils Cursor** : Mise Ã  jour, validation, gestion
- **âœ… Architecture DDD** : Limites, dÃ©pendances, patterns
- **âœ… Serveur MCP** : DÃ©marrage, outils, intÃ©gration

## ğŸ† MÃ©triques de qualitÃ©

- **Taux de rÃ©ussite** : 100% (182/182) âœ…
- **Couverture de code** : > 80%
- **Tests par composant** : Chaque module testÃ©
- **Tests d'intÃ©gration** : Flux complets validÃ©s
- **Performance** : Tests rapides < 1 seconde

## ğŸ”„ Workflow de test

### 1. **DÃ©veloppement local**
```bash
# Tests rapides pendant le dÃ©veloppement
uv run pytest tests/quick/ -v

# Tests spÃ©cifiques Ã  votre fonctionnalitÃ©
uv run pytest tests/dev/unit/test_[votre_module].py -v
```

### 2. **Validation avant commit**
```bash
# Tests complets
uv run pytest tests/ -v

# VÃ©rification de la couverture
uv run pytest tests/ --cov=src --cov-report=term-missing
```

### 3. **Pipeline CI/CD**
```bash
# Tests avec rapport pour CI
uv run pytest tests/ --cov=src --cov-report=xml --junitxml=test-results.xml
```

## ğŸ“ Ajout de nouveaux tests

### Structure recommandÃ©e
```python
"""
Unit Test: [Description de la fonctionnalitÃ©]
Task [ID] - [Nom de la tÃ¢che]
Duration: [Temps estimÃ©]
"""

import pytest
import sys
import os

# Add src to path for imports
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..', '..', '..', 'src'))

class Test[NomDuModule]:
    """Test cases for [Description du module]."""
    
    @pytest.mark.unit
    @pytest.mark.[category]
    def test_[nom_du_test](self):
        """Test [description spÃ©cifique]."""
        # Arrange
        # Act  
        # Assert
        pass
```

### Markers Ã  utiliser
- Toujours inclure `@pytest.mark.unit` ou `@pytest.mark.integration`
- Ajouter des markers spÃ©cifiques : `@pytest.mark.mcp`, `@pytest.mark.ddd`, etc.
- Utiliser des noms de test descriptifs

---

**DerniÃ¨re mise Ã  jour** : 2025-01-17  
**Version du projet** : MCP Task Management Server v1.0  
**Architecture** : Domain-Driven Design avec FastMCP 2.0 